/* empty css                  *//* empty css                */import{g as D,c as J,p as $,e as A}from"./taskApi-BS2Yhaaa.js";/* empty css                       */import{_ as H,r as l,c as O,o as X,X as q,y as g,b as d,f as e,d as s,w as o,u as G,ad as K,B as Q,a4 as W,g as Y,h as r,j as E,ae as Z,af as ee,t as _,ag as ae,$ as te,F as se,e as oe,k as le,i as ne,ah as re,a2 as ce,ai as ue,E as ie,x as I,aj as pe,ak as de,l as _e,al as ve}from"./index-CCAfALLo.js";import"./index-Dq7h7Pqt.js";const fe={class:"task-upload-view"},me={class:"upload-container"},ge={class:"card-header"},ke={key:0,class:"upload-progress-area"},he={class:"current-file-info"},ye={class:"file-list"},we={key:1,class:"upload-complete-area"},Ee={key:2,class:"prepare-upload-area"},Te={__name:"TaskUpload",setup(xe){const S=q(),T=Y(),v=l(null),k=l({}),c=l([]),h=l(!1),u=l(0),y=l(0),i=l(-1),m=l(""),x=O(()=>i.value>=0?c.value[i.value]:null);X(()=>{v.value=S.params.id,v.value&&C()});async function C(){try{k.value=await D(v.value)}catch(a){console.error("获取任务信息失败:",a),g.error("获取任务信息失败，请重试。")}}async function U(){h.value=!0;try{const a=sessionStorage.getItem("flawUpdates");if(a){const p=JSON.parse(a);if(p.length>0){m.value="正在保存复盘结果...";try{const n=p.map(w=>J(w));await Promise.all(n),g.success("复盘结果保存成功")}catch(n){console.error("保存复盘结果失败:",n),g.error("保存复盘结果失败，请重试。")}}sessionStorage.removeItem("flawUpdates")}m.value="正在获取文件列表...";const t=await $(v.value);c.value=t.map(p=>({...p,status:"pending"})),await A(v.value),u.value=1,m.value="正在上传文件...",b()}catch(a){console.error("上传流程失败:",a),g.error("上传流程失败，请重试。")}finally{h.value=!1}}function b(){if(i.value>=c.value.length-1){y.value=100,setTimeout(()=>{u.value=2},500);return}i.value++;const a=c.value[i.value];a.status="uploading";const t=Math.random()*800+200;setTimeout(()=>{a.status="success",y.value=Math.round((i.value+1)/c.value.length*100),b()},t)}const P=a=>{switch(a){case"success":return ve;case"uploading":return _e;default:return de}};function F(){T.back()}function N(){T.back()}return(a,t)=>{const p=Q,n=ee,w=Z,M=ae,V=le,L=te,B=ie,R=ue,j=pe,z=W;return r(),d("div",fe,[e(p,{onBack:F,icon:G(K)},{content:o(()=>t[0]||(t[0]=[s("span",{class:"text-large font-600 mr-3"}," 数据上传 ",-1)])),_:1},8,["icon"]),s("div",me,[e(z,{class:"upload-card"},{header:o(()=>[s("div",ge,[s("span",null,"任务上传: "+_(k.value.taskName||"..."),1)])]),default:o(()=>[e(w,{active:u.value,"finish-status":"success","align-center":""},{default:o(()=>[e(n,{title:"准备上传"}),e(n,{title:"正在上传"}),e(n,{title:"上传完成"})]),_:1},8,["active"]),u.value===1?(r(),d("div",ke,[s("h3",null,_(m.value),1),s("p",he,_(x.value?.type)+": "+_(x.value?.info),1),e(M,{percentage:y.value,"stroke-width":15,striped:"","striped-flow":""},null,8,["percentage"]),s("div",ye,[e(L,null,{default:o(()=>[s("ul",null,[(r(!0),d(se,null,oe(c.value,f=>(r(),d("li",{key:f.info},[e(V,null,{default:o(()=>[(r(),ne(re(P(f.status)),{class:ce(f.status)},null,8,["class"]))]),_:2},1024),s("span",null,_(f.type)+": "+_(f.info),1)]))),128))])]),_:1})])])):E("",!0),u.value===2?(r(),d("div",we,[e(R,{icon:"success",title:"数据上传成功","sub-title":`任务 [${k.value.taskCode}] 的所有数据已成功上传至云端服务器。`},{extra:o(()=>[e(B,{type:"primary",onClick:N},{default:o(()=>t[1]||(t[1]=[I("返回任务列表")])),_:1,__:[1]})]),_:1},8,["sub-title"])])):E("",!0),u.value===0?(r(),d("div",Ee,[e(j,{title:"准备开始上传",type:"info",description:"即将开始上传任务数据，请保持网络连接稳定，期间请勿关闭页面。","show-icon":"",closable:!1,center:""}),e(B,{type:"primary",size:"large",onClick:U,loading:h.value},{default:o(()=>t[2]||(t[2]=[I("开始上传")])),_:1,__:[2]},8,["loading"])])):E("",!0)]),_:1})])])}}},Pe=H(Te,[["__scopeId","data-v-72a13e52"]]);export{Pe as default};
