/* empty css                  *//* empty css                           *//* empty css                        */import{l as me,u as A,g as ce,d as fe,a as ke}from"./taskApi-BS2Yhaaa.js";/* empty css                       */import{_ as _e,r as f,a as D,c as ge,A as ve,o as be,y as b,b as O,d as x,f as t,p as Q,w as l,B as ye,C as we,E as Ve,D as Ce,i as k,v as Se,G as xe,H as Ne,I as Ee,g as Te,h as p,J as Pe,K as Ue,x as r,L as he,M as Be,N as z,O as Fe,F as Ie,e as $e,P as Le,Q as De,t as j,R as ze,j as y,S as w,T as Re,U as qe,V as Ke,W as Me}from"./index-CCAfALLo.js";import"./index-Dq7h7Pqt.js";const Ae={class:"task-list-page"},Oe={class:"app-container"},Qe={class:"search-form-container"},je={class:"toolbar"},He={class:"table-wrapper"},Ge={class:"dialog-footer"},Je={__name:"TaskList",setup(We){const V=Te(),P=f(!0),U=f([]),N=f(0),n=D({pageNum:1,pageSize:10,taskCode:"",creator:"",executor:"",taskStatus:""}),H=f([{value:"",label:"全部"},{value:"待巡视",label:"待巡视"},{value:"巡视中",label:"巡视中"},{value:"待上传",label:"待上传"},{value:"已完成",label:"已完成"}]),m=D({open:!1,title:""}),s=f({}),G=D({taskName:[{required:!0,message:"任务名称不能为空",trigger:"blur"}],taskCode:[{required:!0,message:"任务编号不能为空",trigger:"blur"}],creator:[{required:!0,message:"创建人不能为空",trigger:"blur"}],executor:[{required:!0,message:"执行人不能为空",trigger:"blur"}]}),R=f(null),E=f(null),_=f("auto"),q=ge(()=>{const o=new Date,e=o.getFullYear(),T=(o.getMonth()+1).toString().padStart(2,"0"),I=o.getDate().toString().padStart(2,"0");return`TASK-${e}${T}${I}`});ve(_,o=>{s.value.id||(o==="auto"?s.value.taskCode=q.value:s.value.taskCode="")}),be(()=>{const o=sessionStorage.getItem("taskListPageNum");if(o){const e=parseInt(o,10);!isNaN(e)&&e>0&&(n.pageNum=e),sessionStorage.removeItem("taskListPageNum")}g()});async function g(){P.value=!0;try{const o=await me(n);console.log("从后端接收到的任务列表响应:",o),o&&o.rows&&typeof o.total<"u"?(U.value=o.rows,N.value=o.total):(console.error("API响应格式不正确:",o),b.error("获取任务列表失败，数据格式错误。"),U.value=[],N.value=0)}catch(o){console.error("获取任务列表失败:",o),b.error(`获取任务列表时出错: ${o.message}`)}finally{P.value=!1}}function C(){n.pageNum=1,g()}function J(){sessionStorage.removeItem("taskListPageNum"),R.value.resetFields(),C()}function h(){s.value={},E.value&&E.value.resetFields()}function W(){m.open=!1,h()}function Y(){h(),_.value="auto",s.value.taskCode=q.value,m.open=!0,m.title="新增任务"}function X(o){h(),ce(o.id).then(e=>{s.value=e,_.value="custom",m.open=!0,m.title="修改任务"})}function Z(o,e){console.log(`[ handleDelete ] raw args: id=${o}, taskCode=${e}`),Me.confirm(`是否确认删除任务编号为"${e}"的数据项?`,"系统提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>fe(o)).then(()=>{b.success("删除成功"),g()}).catch(()=>{})}async function ee(){await E.value.validate(),s.value.id!=null?(await A(s.value),b.success("修改成功")):(await ke(s.value),b.success("新增成功")),m.open=!1,g()}function B(o){sessionStorage.setItem("taskListPageNum",n.pageNum),V.push({name:"task-review",params:{id:o.id}})}async function F(o){if(sessionStorage.setItem("taskListPageNum",n.pageNum),o.taskStatus==="待巡视")try{const e={...o,taskStatus:"巡视中"};await A(e),V.push({name:"task-execute",params:{id:o.id}})}catch(e){b.error("手动更新任务状态失败: "+(e?.message||"未知错误")),console.error("手动更新任务状态失败:",e)}else V.push({name:"task-execute",params:{id:o.id}})}function te(o){const e=o.taskStatus;e==="待巡视"||e==="巡视中"?F(o):(e==="待上传"||e==="已完成")&&B(o)}function ae(){V.push({name:"settings"})}function le(){V.back()}function oe(o){switch(o){case"待巡视":return"info";case"巡视中":return"primary";case"待上传":return"warning";case"已完成":return"success";default:return"info"}}return(o,e)=>{const T=Ue,I=Pe,u=Ve,se=ye,c=Be,i=he,$=Le,K=Fe,M=we,d=De,ne=ze,re=Ee,ue=xe,v=qe,L=Re,ie=Ke,de=Ne,pe=Ce;return p(),O("div",Ae,[x("div",Oe,[t(se,{onBack:le,class:"page-header"},{content:l(()=>[t(I,{separator:"/"},{default:l(()=>[t(T,null,{default:l(()=>e[15]||(e[15]=[r("地铁隧道巡线车智能巡检系统")])),_:1,__:[15]}),t(T,null,{default:l(()=>e[16]||(e[16]=[r("任务列表")])),_:1,__:[16]})]),_:1})]),extra:l(()=>[t(u,{circle:"",icon:"Setting",onClick:ae})]),_:1}),x("div",Qe,[t(M,{model:n,ref_key:"queryFormRef",ref:R,inline:!0,"label-position":"top"},{default:l(()=>[t(i,{label:"任务编号",prop:"taskCode"},{default:l(()=>[t(c,{modelValue:n.taskCode,"onUpdate:modelValue":e[0]||(e[0]=a=>n.taskCode=a),placeholder:"请输入任务编号",clearable:"",onKeyup:z(C,["enter"])},null,8,["modelValue"])]),_:1}),t(i,{label:"创建人",prop:"creator"},{default:l(()=>[t(c,{modelValue:n.creator,"onUpdate:modelValue":e[1]||(e[1]=a=>n.creator=a),placeholder:"请输入创建人",clearable:"",onKeyup:z(C,["enter"])},null,8,["modelValue"])]),_:1}),t(i,{label:"执行人",prop:"executor"},{default:l(()=>[t(c,{modelValue:n.executor,"onUpdate:modelValue":e[2]||(e[2]=a=>n.executor=a),placeholder:"请输入执行人",clearable:"",onKeyup:z(C,["enter"])},null,8,["modelValue"])]),_:1}),t(i,{label:"状态",prop:"taskStatus"},{default:l(()=>[t(K,{modelValue:n.taskStatus,"onUpdate:modelValue":e[3]||(e[3]=a=>n.taskStatus=a),placeholder:"请选择状态",clearable:"",style:{width:"180px"}},{default:l(()=>[(p(!0),O(Ie,null,$e(H.value,a=>(p(),k($,{key:a.value,label:a.label,value:a.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(i,{class:"action-buttons"},{default:l(()=>[t(u,{type:"primary",onClick:C},{default:l(()=>e[17]||(e[17]=[r("搜索")])),_:1,__:[17]}),t(u,{onClick:J},{default:l(()=>e[18]||(e[18]=[r("重置")])),_:1,__:[18]})]),_:1})]),_:1},8,["model"])]),x("div",je,[t(u,{type:"primary",onClick:Y},{default:l(()=>e[19]||(e[19]=[r("新增任务")])),_:1,__:[19]})]),x("div",He,[Q((p(),k(re,{data:U.value,stripe:"",onRowClick:te,"row-key":"id"},{default:l(()=>[t(d,{type:"index",label:"序号",width:"60",align:"center"}),t(d,{label:"任务编号",prop:"taskCode",width:"200"},{default:l(a=>[t(u,{link:"",type:"primary"},{default:l(()=>[r(j(a.row.taskCode),1)]),_:2},1024)]),_:1}),t(d,{label:"任务名称",prop:"taskName","show-overflow-tooltip":!0}),t(d,{label:"起始地点",prop:"startPos",align:"center",width:"120"}),t(d,{label:"任务距离(m)",prop:"taskTrip",align:"center",width:"120"}),t(d,{label:"创建人",prop:"creator",align:"center",width:"120"}),t(d,{label:"执行人",prop:"executor",align:"center",width:"120"}),t(d,{label:"完成时间",prop:"endTime",align:"center",width:"180"}),t(d,{label:"状态",align:"center",width:"120"},{default:l(a=>[t(ne,{type:oe(a.row.taskStatus),"disable-transitions":""},{default:l(()=>[r(j(a.row.taskStatus),1)]),_:2},1032,["type"])]),_:1}),t(d,{label:"操作",align:"center",width:"220"},{default:l(a=>[a.row.taskStatus==="待巡视"?(p(),k(u,{key:0,link:"",type:"primary",icon:"VideoPlay",onClick:w(S=>F(a.row),["stop"])},{default:l(()=>e[20]||(e[20]=[r("开始巡视")])),_:2,__:[20]},1032,["onClick"])):y("",!0),a.row.taskStatus==="巡视中"?(p(),k(u,{key:1,link:"",type:"primary",icon:"VideoPlay",onClick:w(S=>F(a.row),["stop"])},{default:l(()=>e[21]||(e[21]=[r("继续巡视")])),_:2,__:[21]},1032,["onClick"])):y("",!0),a.row.taskStatus==="待上传"?(p(),k(u,{key:2,link:"",type:"primary",icon:"DocumentChecked",onClick:w(S=>B(a.row),["stop"])},{default:l(()=>e[22]||(e[22]=[r("复盘")])),_:2,__:[22]},1032,["onClick"])):y("",!0),a.row.taskStatus==="已完成"?(p(),k(u,{key:3,link:"",type:"primary",icon:"View",onClick:w(S=>B(a.row),["stop"])},{default:l(()=>e[23]||(e[23]=[r("查看报告")])),_:2,__:[23]},1032,["onClick"])):y("",!0),a.row.taskStatus==="待巡视"?(p(),k(u,{key:4,link:"",type:"primary",icon:"Edit",onClick:w(S=>X(a.row),["stop"])},{default:l(()=>e[24]||(e[24]=[r("修改")])),_:2,__:[24]},1032,["onClick"])):y("",!0),a.row.taskStatus==="待巡视"?(p(),k(u,{key:5,link:"",type:"danger",icon:"Delete",onClick:w(S=>Z(a.row.id,a.row.taskCode),["stop"])},{default:l(()=>e[25]||(e[25]=[r("删除")])),_:2,__:[25]},1032,["onClick"])):y("",!0)]),_:1})]),_:1},8,["data"])),[[pe,P.value]])]),Q(t(ue,{class:"pagination","current-page":n.pageNum,"onUpdate:currentPage":e[4]||(e[4]=a=>n.pageNum=a),"page-size":n.pageSize,"onUpdate:pageSize":e[5]||(e[5]=a=>n.pageSize=a),"page-sizes":[10,20,50,100],background:!0,layout:"total, sizes, prev, pager, next, jumper",total:N.value,onSizeChange:g,onCurrentChange:g},null,8,["current-page","page-size","total"]),[[Se,N.value>0]]),t(de,{title:m.title,modelValue:m.open,"onUpdate:modelValue":e[14]||(e[14]=a=>m.open=a),width:"800px","append-to-body":""},{footer:l(()=>[x("div",Ge,[t(u,{onClick:W},{default:l(()=>e[26]||(e[26]=[r("取 消")])),_:1,__:[26]}),t(u,{type:"primary",onClick:ee},{default:l(()=>e[27]||(e[27]=[r("确 定")])),_:1,__:[27]})])]),default:l(()=>[t(M,{ref_key:"taskFormRef",ref:E,model:s.value,rules:G,"label-width":"100px"},{default:l(()=>[t(L,{gutter:20},{default:l(()=>[t(v,{span:12},{default:l(()=>[t(i,{label:"任务名称",prop:"taskName"},{default:l(()=>[t(c,{modelValue:s.value.taskName,"onUpdate:modelValue":e[6]||(e[6]=a=>s.value.taskName=a),placeholder:"请输入任务名称"},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:12},{default:l(()=>[t(i,{label:"任务编号",prop:"taskCode"},{default:l(()=>[t(c,{modelValue:s.value.taskCode,"onUpdate:modelValue":e[8]||(e[8]=a=>s.value.taskCode=a),placeholder:_.value==="auto"?"":"请输入自定义编号",disabled:!!s.value.id,class:"input-with-select"},{prepend:l(()=>[t(K,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=a=>_.value=a),disabled:!!s.value.id,style:{width:"110px"}},{default:l(()=>[t($,{label:"自动生成",value:"auto"}),t($,{label:"自定义",value:"custom"})]),_:1},8,["modelValue","disabled"])]),_:1},8,["modelValue","placeholder","disabled"])]),_:1})]),_:1})]),_:1}),t(L,{gutter:20},{default:l(()=>[t(v,{span:12},{default:l(()=>[t(i,{label:"起始地点",prop:"startPos"},{default:l(()=>[t(c,{modelValue:s.value.startPos,"onUpdate:modelValue":e[9]||(e[9]=a=>s.value.startPos=a),placeholder:"请输入起始地点"},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:12},{default:l(()=>[t(i,{label:"任务距离(m)",prop:"taskTrip"},{default:l(()=>[t(ie,{modelValue:s.value.taskTrip,"onUpdate:modelValue":e[10]||(e[10]=a=>s.value.taskTrip=a),min:0,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(L,{gutter:20},{default:l(()=>[t(v,{span:12},{default:l(()=>[t(i,{label:"创建人",prop:"creator"},{default:l(()=>[t(c,{modelValue:s.value.creator,"onUpdate:modelValue":e[11]||(e[11]=a=>s.value.creator=a),placeholder:"请输入创建人"},null,8,["modelValue"])]),_:1})]),_:1}),t(v,{span:12},{default:l(()=>[t(i,{label:"执行人",prop:"executor"},{default:l(()=>[t(c,{modelValue:s.value.executor,"onUpdate:modelValue":e[12]||(e[12]=a=>s.value.executor=a),placeholder:"请输入执行人"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),t(i,{label:"备注",prop:"remark"},{default:l(()=>[t(c,{modelValue:s.value.remark,"onUpdate:modelValue":e[13]||(e[13]=a=>s.value.remark=a),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"])])])}}},ot=_e(Je,[["__scopeId","data-v-8a8e7faf"]]);export{ot as default};
