import{r as m,a as j,o as A,b as x,d as p,f as l,w as t,z as n,g as D,h as V,x as i,t as k,F as R,e as q,i as z}from"./index-CCAfALLo.js";import{a as C}from"./index-Dq7h7Pqt.js";const G={class:"app-container"},H={class:"notification-bar"},J={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},K={class:"p-4 flex flex-col gap-4"},O={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Q={class:"flex justify-end gap-4",style:{"margin-top":"3rem"}},E="/prod-api",Z={__name:"SystemSettings",setup(W){const S=D(),r=m(!1),y=m(""),P=m(""),v=m(!1),f=m(!1),h=m([!0,!1,!1,!1]),o=j({id:null,host:"",drivePort:null,analysisPort:null,cloudUrl:"",cameras:[{id:1,name:"前方主视角",address:"",user:"",password:"",showPassword:!1},{id:2,name:"左侧视角",address:"",user:"",password:"",showPassword:!1},{id:3,name:"右侧视角",address:"",user:"",password:"",showPassword:!1},{id:4,name:"后方视角",address:"",user:"",password:"",showPassword:!1}]}),T=a=>{o.id=a.id,o.host=a.host,o.drivePort=a.drivePort,o.analysisPort=a.analysisPort,o.cloudUrl=a.cloudUrl,o.cameras.forEach((e,d)=>{e.address=a[`cam${d+1}`]||"",e.user=a[`username${d+1}`]||"",e.password=a[`password${d+1}`]||""})},_=(a,e="success")=>{e==="success"?(P.value=a,f.value=!0,setTimeout(()=>f.value=!1,3e3)):(y.value=a,v.value=!0,setTimeout(()=>v.value=!1,3e3))},B=async()=>{r.value=!0;try{const a=await C.get(`${E}/agv/config`);if(a.data.code===200&&a.data.data)T(a.data.data),_("配置已成功加载");else throw new Error(a.data.msg||"获取配置失败")}catch(a){const e=a.response?.data?.msg||a.message||"加载配置时发生未知错误";_(e,"error")}finally{r.value=!1}},M=async()=>{r.value=!0;const a={id:o.id,host:o.host,drivePort:o.drivePort,analysisPort:o.analysisPort,cloudUrl:o.cloudUrl};o.cameras.forEach((e,d)=>{a[`cam${d+1}`]=e.address,a[`username${d+1}`]=e.user,a[`password${d+1}`]=e.password}),console.log("准备保存的数据:",a);try{const e=await C.put(`${E}/agv/config`,a,{headers:{"Content-Type":"application/json"}});if(e.data.code===200)_("设置已成功保存！");else throw new Error(e.data.msg||"保存失败")}catch(e){const d=e.response?.data?.msg||e.message||"保存时发生未知错误";_(d,"error")}finally{r.value=!1}},N=()=>{S.back()};return A(()=>{B()}),(a,e)=>{const d=n("va-icon"),U=n("va-alert"),g=n("va-card-title"),u=n("va-input"),F=n("va-form"),b=n("va-card-content"),w=n("va-card"),I=n("va-collapse"),L=n("va-accordion"),$=n("va-button");return V(),x("div",G,[p("div",H,[l(U,{modelValue:f.value,"onUpdate:modelValue":e[0]||(e[0]=s=>f.value=s),color:"success",class:"mb-4",closeable:""},{default:t(()=>[l(d,{name:"check_circle",class:"mr-2"}),i(" "+k(P.value),1)]),_:1},8,["modelValue"]),l(U,{modelValue:v.value,"onUpdate:modelValue":e[1]||(e[1]=s=>v.value=s),color:"danger",class:"mb-4",closeable:""},{default:t(()=>[l(d,{name:"warning",class:"mr-2"}),i(" "+k(y.value),1)]),_:1},8,["modelValue"])]),e[12]||(e[12]=p("h1",{class:"va-h1",style:{"text-align":"center","margin-bottom":"2rem"}},"系统设置",-1)),l(w,null,{default:t(()=>[l(g,{class:"flex items-center"},{default:t(()=>[l(d,{name:"directions_car",color:"primary",class:"mr-2"}),e[7]||(e[7]=i(" 车辆控制设置 "))]),_:1,__:[7]}),l(b,null,{default:t(()=>[l(F,{tag:"div",class:"flex flex-col gap-4"},{default:t(()=>[l(u,{modelValue:o.host,"onUpdate:modelValue":e[2]||(e[2]=s=>o.host=s),label:"车辆IP地址 *",placeholder:"192.168.1.100",rules:[s=>s&&s.length>0||"IP地址不能为空"],disabled:r.value},{"prepend-inner":t(()=>[l(d,{name:"settings_ethernet",color:"secondary"})]),_:1},8,["modelValue","rules","disabled"]),p("div",J,[l(u,{modelValue:o.drivePort,"onUpdate:modelValue":e[3]||(e[3]=s=>o.drivePort=s),modelModifiers:{number:!0},type:"number",label:"车辆控制端口 *",rules:[s=>s>0||"端口号必须大于0"],disabled:r.value},null,8,["modelValue","rules","disabled"]),l(u,{modelValue:o.analysisPort,"onUpdate:modelValue":e[4]||(e[4]=s=>o.analysisPort=s),modelModifiers:{number:!0},type:"number",label:"分析程序端口 *",rules:[s=>s>0||"端口号必须大于0"],disabled:r.value},null,8,["modelValue","rules","disabled"])])]),_:1})]),_:1})]),_:1}),l(w,null,{default:t(()=>[l(g,{class:"flex items-center"},{default:t(()=>[l(d,{name:"cloud_queue",color:"info",class:"mr-2"}),e[8]||(e[8]=i(" 云端平台设置 "))]),_:1,__:[8]}),l(b,null,{default:t(()=>[l(u,{modelValue:o.cloudUrl,"onUpdate:modelValue":e[5]||(e[5]=s=>o.cloudUrl=s),label:"云端平台地址 *",placeholder:"https://api.inspection.com",rules:[s=>s&&s.length>0||"云端地址不能为空"],disabled:r.value},{"prepend-inner":t(()=>[l(d,{name:"link",color:"secondary"})]),_:1},8,["modelValue","rules","disabled"])]),_:1})]),_:1}),l(w,null,{default:t(()=>[l(g,{class:"flex items-center"},{default:t(()=>[l(d,{name:"videocam",color:"success",class:"mr-2"}),e[9]||(e[9]=i(" 摄像头设置 "))]),_:1,__:[9]}),l(b,null,{default:t(()=>[l(L,{modelValue:h.value,"onUpdate:modelValue":e[6]||(e[6]=s=>h.value=s),multiple:""},{default:t(()=>[(V(!0),x(R,null,q(o.cameras,s=>(V(),z(I,{key:s.id,header:`摄像头 ${s.id} - ${s.name}`},{default:t(()=>[p("div",K,[l(u,{modelValue:s.address,"onUpdate:modelValue":c=>s.address=c,label:`摄像头 ${s.id} 地址`,placeholder:"rtsp://...",disabled:r.value},null,8,["modelValue","onUpdate:modelValue","label","disabled"]),p("div",O,[l(u,{modelValue:s.user,"onUpdate:modelValue":c=>s.user=c,label:`摄像头 ${s.id} 账号`,disabled:r.value},null,8,["modelValue","onUpdate:modelValue","label","disabled"]),l(u,{modelValue:s.password,"onUpdate:modelValue":c=>s.password=c,type:s.showPassword?"text":"password",label:`摄像头 ${s.id} 密码`,disabled:r.value},{"append-inner":t(()=>[l(d,{name:s.showPassword?"visibility_off":"visibility",class:"cursor-pointer",onClick:c=>s.showPassword=!s.showPassword},null,8,["name","onClick"])]),_:2},1032,["modelValue","onUpdate:modelValue","type","label","disabled"])])])]),_:2},1032,["header"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),p("div",Q,[l($,{preset:"secondary",onClick:N,disabled:r.value},{default:t(()=>e[10]||(e[10]=[i("取消")])),_:1,__:[10]},8,["disabled"]),l($,{onClick:M,loading:r.value},{default:t(()=>e[11]||(e[11]=[i("保存设置")])),_:1,__:[11]},8,["loading"])])])}}};export{Z as default};
