/* empty css                  *//* empty css                           *//* empty css                        */import{g as te,b as oe}from"./taskApi-BS2Yhaaa.js";/* empty css                *//* empty css                        *//* empty css                       */import{_ as se,r as m,c as w,o as ne,X as re,y as R,p as ie,D as de,b as g,f as a,d as s,w as l,B as ue,a5 as ce,a6 as me,F as _e,e as fe,$ as pe,H as ve,g as be,h as k,E as we,x as n,J as ge,K as ke,k as ye,u as Ee,a7 as Ie,Z as Ce,a2 as Ve,a8 as xe,a4 as Ne,a9 as Te,aa as De,t as u,I as Fe,Q as Se,S as Ue,j as he,C as Be,L as Re,ab as $e,ac as Me,M as Je}from"./index-CCAfALLo.js";import"./index-Dq7h7Pqt.js";const Le={class:"task-detail-view"},ze={class:"header-actions"},He={class:"main-container"},Oe={class:"content-area"},Pe={class:"image-area"},Ae={class:"image-slot"},je={class:"scale-bar-area"},Ge=["onClick"],Ke={class:"sidebar"},Qe={class:"status-confirmed"},Xe={class:"status-pending"},Ze={key:0,class:"modal-body"},qe={class:"modal-image-container"},We={class:"modal-info-container"},Ye={class:"dialog-footer"},ea={__name:"TaskReview",setup(aa){const $=re(),x=be(),y=m(!0),f=m(null),_=m({}),c=m([]),N=m(0),T=m(new Map),o=m(null),p=m(!1),M=w(()=>o.value?o.value.flawImageUrl:""),E=w(()=>o.value?o.value.initialConfirmed!==null:!0),J=w(()=>c.value.length===0?!0:c.value.every(t=>t.confirmed!==null));ne(()=>{f.value=$.params.id,f.value&&L()});async function L(){y.value=!0;try{const[t,e]=await Promise.all([te(f.value),oe({taskId:f.value,pageSize:999})]);_.value=t,c.value=e.rows.filter(i=>i.taskId==f.value).map(i=>{const V=i.flawImageUrl?`/prod-api/file${i.flawImageUrl}`:"";return{...i,flawImageUrl:V,initialConfirmed:i.confirmed}})}catch(t){console.error("èŽ·å–å¤ç›˜æ•°æ®å¤±è´¥:",t),R.error("èŽ·å–å¤ç›˜æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–è”ç³»ç®¡ç†å‘˜")}finally{y.value=!1}}function z(){x.back()}const H=t=>{const e=parseFloat(_.value.taskTrip);return e?`${t/e*100}%`:"0%"};function D(t){return t.confirmed===!0?{text:"å·²ç¡®è®¤",className:"status-confirmed"}:t.confirmed===!1?{text:"å·²å¿½ç•¥",className:"status-ignored"}:{text:"å¾…å¤„ç†",className:"status-pending"}}const I=w(()=>{const t={total:c.value.length,confirmed:0,pending:0,ignored:0};return c.value.forEach(e=>{e.confirmed===!0?t.confirmed++:e.confirmed===!1?t.ignored++:t.pending++}),t}),O=({row:t})=>D(t).className;function C(t){o.value=JSON.parse(JSON.stringify(t)),p.value=!0}function P(){if(!o.value)return;const t=c.value.findIndex(e=>e.id===o.value.id);if(t!==-1){const e={...c.value[t],confirmed:o.value.confirmed,remark:o.value.remark};c.value.splice(t,1,e),T.value.set(o.value.id,{id:o.value.id,confirmed:o.value.confirmed,remark:o.value.remark}),R.success("ä¿®æ”¹å·²æš‚å­˜")}p.value=!1}function A(){const t=Array.from(T.value.values());sessionStorage.setItem("flawUpdates",JSON.stringify(t)),x.push({name:"task-upload",params:{id:f.value}})}return(t,e)=>{const i=ke,V=ge,v=we,j=ue,G=ye,F=ce,K=me,Q=xe,d=De,S=Te,U=Ne,b=Se,X=Fe,Z=pe,h=Me,q=$e,B=Re,W=Je,Y=Be,ee=ve,ae=de;return ie((k(),g("div",Le,[a(j,{onBack:z},{content:l(()=>[a(V,{separator:"/"},{default:l(()=>[a(i,null,{default:l(()=>e[5]||(e[5]=[n("åœ°é“éš§é“å·¡çº¿è½¦æ™ºèƒ½å·¡æ£€ç³»ç»Ÿ")])),_:1,__:[5]}),a(i,null,{default:l(()=>e[6]||(e[6]=[n("ä»»åŠ¡åˆ—è¡¨")])),_:1,__:[6]}),a(i,null,{default:l(()=>e[7]||(e[7]=[n("ä»»åŠ¡è¯¦æƒ…ä¸Žå¤ç›˜")])),_:1,__:[7]})]),_:1})]),extra:l(()=>[s("div",ze,[a(v,{type:"primary",onClick:A,disabled:!J.value},{default:l(()=>e[8]||(e[8]=[n(" å®Œæˆå¤ç›˜å¹¶ä¸Šä¼  ")])),_:1,__:[8]},8,["disabled"])])]),_:1}),s("div",He,[s("div",Oe,[s("div",Pe,[a(F,{src:M.value,fit:"contain"},{error:l(()=>[s("div",Ae,[a(G,null,{default:l(()=>[a(Ee(Ie))]),_:1}),e[9]||(e[9]=s("span",null,"è¯·ä»Žå³ä¾§æˆ–ä¸‹æ–¹é€‰æ‹©ä¸€ä¸ªç¼ºé™·ä»¥é¢„è§ˆå›¾ç‰‡",-1))])]),_:1},8,["src"])]),s("div",je,[a(K,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=r=>N.value=r),max:parseFloat(_.value.taskTrip)||100,"show-tooltip":!1,disabled:""},null,8,["modelValue","max"]),(k(!0),g(_e,null,fe(c.value,r=>(k(),g("div",{key:`marker-${r.id}`,class:Ve(["flaw-marker",D(r).className]),style:Ce({left:H(r.flawDistance)}),onClick:le=>C(r)},[a(Q,{content:r.flawName,placement:"top"},{default:l(()=>e[10]||(e[10]=[s("span",null,"ðŸ“",-1)])),_:2,__:[10]},1032,["content"])],14,Ge))),128))])]),s("div",Ke,[a(Z,null,{default:l(()=>[a(U,{shadow:"never",class:"info-card"},{header:l(()=>e[11]||(e[11]=[s("div",{class:"card-header"},[s("span",null,"ðŸ“„ ä»»åŠ¡ä¿¡æ¯")],-1)])),default:l(()=>[a(S,{column:1,border:""},{default:l(()=>[a(d,{label:"ä»»åŠ¡ç¼–å·"},{default:l(()=>[n(u(_.value.taskCode),1)]),_:1}),a(d,{label:"å¼€å§‹æ—¶é—´"},{default:l(()=>[n(u(_.value.execTime),1)]),_:1}),a(d,{label:"ç»“æŸæ—¶é—´"},{default:l(()=>[n(u(_.value.endTime),1)]),_:1}),a(d,{label:"è¡Œé©¶è·ç¦»"},{default:l(()=>[n(u(_.value.taskTrip)+" ç±³",1)]),_:1}),a(d,{label:"æ•…éšœæ€»è®¡"},{default:l(()=>[n(u(I.value.total),1)]),_:1}),a(d,{label:"å·²ç¡®å®šæ•…éšœ"},{default:l(()=>[s("span",Qe,u(I.value.confirmed),1)]),_:1}),a(d,{label:"ç–‘ä¼¼æ•…éšœ"},{default:l(()=>[s("span",Xe,u(I.value.pending),1)]),_:1})]),_:1})]),_:1}),a(U,{shadow:"never",class:"info-card"},{header:l(()=>e[12]||(e[12]=[s("div",{class:"card-header"},[s("span",null,"âš ï¸ æ•…éšœåŽ†å²")],-1)])),default:l(()=>[a(X,{data:c.value,style:{width:"100%"},onRowClick:C,"row-class-name":O},{default:l(()=>[a(b,{prop:"flawName",label:"æ•…éšœåç§°"}),a(b,{prop:"flawType",label:"ç±»åž‹",width:"80"}),a(b,{prop:"flawDistance",label:"ä½ç½®(m)",width:"80"}),a(b,{label:"æ“ä½œ",width:"70",align:"center"},{default:l(r=>[a(v,{link:"",type:"primary",onClick:Ue(le=>C(r.row),["stop"])},{default:l(()=>e[13]||(e[13]=[n("è¯¦æƒ…")])),_:2,__:[13]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})])]),a(ee,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=r=>p.value=r),title:"æ•…éšœè¯¦æƒ…ä¸Žç¡®è®¤",width:"70%",top:"5vh"},{footer:l(()=>[s("span",Ye,[a(v,{onClick:e[3]||(e[3]=r=>p.value=!1)},{default:l(()=>e[16]||(e[16]=[n("å– æ¶ˆ")])),_:1,__:[16]}),a(v,{type:"primary",onClick:P,disabled:E.value},{default:l(()=>e[17]||(e[17]=[n("ç¡® å®š")])),_:1,__:[17]},8,["disabled"])])]),default:l(()=>[o.value?(k(),g("div",Ze,[s("div",qe,[a(F,{src:o.value.flawImageUrl,fit:"contain","preview-src-list":[o.value.flawImageUrl],"preview-teleported":""},null,8,["src","preview-src-list"])]),s("div",We,[a(S,{column:1,border:"",title:"æ•…éšœä¿¡æ¯"},{default:l(()=>[a(d,{label:"æ•…éšœåç§°"},{default:l(()=>[n(u(o.value.flawName),1)]),_:1}),a(d,{label:"æ•…éšœç±»åž‹"},{default:l(()=>[n(u(o.value.flawType),1)]),_:1}),a(d,{label:"æ•…éšœæè¿°"},{default:l(()=>[n(u(o.value.flawDesc||"æ— "),1)]),_:1}),a(d,{label:"æ•…éšœä½ç½®"},{default:l(()=>[n(u(o.value.flawDistance)+" ç±³",1)]),_:1})]),_:1}),a(Y,{class:"modal-form","label-position":"top",model:o.value},{default:l(()=>[a(B,{label:"æ˜¯å¦å±žå®ž"},{default:l(()=>[a(q,{modelValue:o.value.confirmed,"onUpdate:modelValue":e[1]||(e[1]=r=>o.value.confirmed=r),disabled:E.value},{default:l(()=>[a(h,{value:!0},{default:l(()=>e[14]||(e[14]=[n("æ˜¯")])),_:1,__:[14]}),a(h,{value:!1},{default:l(()=>e[15]||(e[15]=[n("å¦ (è¯¯æŠ¥)")])),_:1,__:[15]})]),_:1},8,["modelValue","disabled"])]),_:1}),a(B,{label:"è¡¥å……è¯´æ˜Ž"},{default:l(()=>[a(W,{modelValue:o.value.remark,"onUpdate:modelValue":e[2]||(e[2]=r=>o.value.remark=r),type:"textarea",rows:5,placeholder:"è¯·è¾“å…¥è¡¥å……è¯´æ˜Ž",disabled:E.value},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model"])])])):he("",!0)]),_:1},8,["modelValue"])])),[[ae,y.value]])}}},ca=se(ea,[["__scopeId","data-v-b0c00510"]]);export{ca as default};
